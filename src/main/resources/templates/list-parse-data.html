<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="author" content="Vivek, Rakshanda, Abhishek, Sarfaraz, Sidharth">
	<meta name="description" content="JUnit Auto Generator">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AutoJ Generator</title>

	<!-- Bootstrap CDN Insert -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
		crossorigin="anonymous"></script>
		
	<script th:inline="javascript">
        function toggleKeyCheck(key) {
            var keyCheckbox = document.getElementById(key);
            var valueCheckboxes = document.querySelectorAll('[data-key="' + key + '"]');
            
            var allChecked = keyCheckbox.checked;
            valueCheckboxes.forEach(function(checkbox) {
                checkbox.checked = allChecked;
            });
        }

        function toggleValueCheck(key) {
            var valueCheckboxes = document.querySelectorAll('[data-key="' + key + '"]');
            var keyCheckbox = document.getElementById(key);

            var allChecked = true;
            valueCheckboxes.forEach(function(checkbox) {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });

            keyCheckbox.checked = allChecked;
        }

		function prepareFormData() {
			var formData = {};
			var checkboxes = document.querySelectorAll('input[type="checkbox"]');
			checkboxes.forEach(function (checkbox) {
				var key = checkbox.getAttribute('data-key');
				var value = checkbox.value;

				if (checkbox.checked) {
					if (!formData[key]) {
						formData[key] = [];
					}
					formData[key].push(value);
				}
			});
			// Set the formData into a hidden input field for submission
			document.getElementById('formDataInput').value = JSON.stringify(formData);
		}
	</script>
</head>

<body>
	<div th:if="${message != null}">
		The message is: <span th:text="${message}">
	</div>
	<div th:unless="${message != null}">
		<form th:action="@{/autoj/listSelectedData}" method="post" onsubmit="prepareFormData()">
			<div th:each="entry : ${parsedData}">
				<label th:text="${entry.key}"></label><br />
				<input type="checkbox" th:id="${entry.key}" th:attr="data-key=${entry.key}"
					onclick="toggleKeyCheck(this.getAttribute('data-key'))" /><br />
				<div th:each="value : ${entry.value}">
					&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" th:attr="data-key=${entry.key}, value=${value}"
						onclick="toggleValueCheck('${entry.key}')" /><label
						th:text="${value}"></label><br />
				</div>
			</div>
			<input type="hidden" name="formData" id="formDataInput" />
			<button type="submit">Submit</button>
		</form>
	</div>
</body>